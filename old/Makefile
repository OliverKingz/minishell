#â—‰â”€â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Colors:   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

BLACK   := \033[0;30m
RED     := \033[0;31m
GREEN   := \033[0;32m
YELLOW  := \033[0;33m
BLUE    := \033[0;34m
MAGENTA := \033[0;35m
CYAN    := \033[0;36m

CURRENT_COLOR := \033[0;34m
RESET   := \033[0m

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Variables:   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

NAME        := minishell
CC          := cc
CFLAGS      := -Wall -Werror -Wextra -g
RM          := rm -rf

VALGRIND := valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes --error-limit=no --log-file=test/valgrind_outputs/valgrind_output_$(shell date +%Y%m%d_%H%M%S).log -s

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢ Libft Variables â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â—‰#

LIBFT_DIR	:= libft/
LIBFT		:= $(LIBFT_DIR)/libft.a
INCLUDES_LIBFT := -I$(LIBFT_DIR)

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢    minishell srcs   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

MINISHELL_SRCS  :=	 check_is_var.c \
					check_line_utils.c \
					check_spaces_line.c \
					check_spaces_line_utils.c \
					check_syntax_error_line.c \
					check_syntax_error_token.c \
					check_type_tokens.c \
					check_type_tokens_utils.c \
					ckeck_quote_utils.c \
					exe_cmd.c \
					free_utils.c \
					ft_tokeniser.c \
					list_utils.c \
					main.c \
					test_funcionts.c \
					test_utils.c \
					token_utils.c \
					tokenize_with_quotes.c \
					utils.c \
					heredoc.c \
					#signals.c \
					#check_reserved_words.c \

MINISHELL_OBJS  := $(MINISHELL_SRCS:.c=.o)

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢     rules      â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

all: $(LIBFT) $(NAME)

$(LIBFT): $(LIBFT_DEPS)
	$(MAKE) -C $(LIBFT_DIR)

$(NAME): $(LIBFT) $(MINISHELL_OBJS) 
	$(CC) $(CFLAGS) -o $(NAME) $(MINISHELL_OBJS) -L$(LIBFT_DIR) -lreadline -lft $(INCLUDES_LIBFT) 
	@echo "$(CURRENT_COLOR) âœ… $(NAME) created.\n$(RESET)"

%.o: %.c
	$(CC) $(CFLAGS) $(INCLUDES_LIBFT) -c $< -o $@ 

clean:
	$(RM) $(MINISHELL_OBJS)
	@$(MAKE) -C $(LIBFT_DIR) clean
	@echo "$(CURRENT_COLOR)ðŸ§¹ Object files cleaned.\n$(RESET)"

fclean: clean
	$(RM) $(NAME)
	@$(MAKE) -C $(LIBFT_DIR) fclean
	@echo "$(CURRENT_COLOR) ðŸ§¹ $(NAME) and libft.a: binary cleaned.\n$(RESET)"

re: fclean all

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Valgrind   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

valgrind: all

	@echo "$(CURRENT_COLOR)âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€Running Valgrind..â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€$(RESET)"
	@-$(VALGRIND) ./$(NAME)
	@test/hs_files/./open_valgrind_log.sh
	@echo "$(CURRENT_COLOR)âžµâ¤â•Œâ•Œâž£â‹†âž£â•Œâ”€â¤âžµâ€¢âžµâ¤â”€â•Œâ•Œâž£â‹†âž£â”€â”€ Valgrind completed. Check valgrind_output.log for details. â”€â•Œâž£â‹†âž£â•Œâ”€â¤âžµâ€¢âžµâ¤â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€$(RESET)"
	
clean_valgrind:
	test/hs_files/./clean_valgrind.sh

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Test    â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

test: all
#revisar que *.sh tienen permisos en /test/sh_files/
	@echo "Ensuring all scripts in /test/hs_files/ have execution permissions..."
	@find test/hs_files/ -name "*.sh" ! -perm -111 -exec chmod +x {} \;
#startr test
	@echo "$(CURRENT_COLOR)âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€ Starting test: â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâž”$(RESET)"
	@test/hs_files/./test_minishell.sh
	@echo "$(CURRENT_COLOR)âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€ End of test. â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâž”$(RESET)"

clean_test:
	test/hs_files/./clean_test.sh

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢Norminette â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

norm:
	@echo "$(CURRENT_COLOR)âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€ Checking Norminette: â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâž”$(RESET)"
	@norminette $(MINISHELL_SRCS) minishell.h
	@echo "$(CURRENT_COLOR)âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€â¤âžµâ€¢âžµâ¤â”€â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€â”€ Norminette completed. Check your output for details. â”€â•Œâž£â‹†âž£â•Œâ”€â¤âžµâ€¢âžµâ¤â”€â•Œâ•Œâž£â‹†âž£â•Œâ•Œâ”€$(RESET)"

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢  Format â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

format: 
	c_formatter_42 $(MINISHELL_SRCS) minishell.h

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢ Phony targets â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

.PHONY: all clean fclean re format norm valgrind test clean_valgrind clean_test 